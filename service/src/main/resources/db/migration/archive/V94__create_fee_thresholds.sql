CREATE TABLE fee_thresholds (
    id uuid NOT NULL,
    valid_during daterange NOT NULL,
    min_income_threshold_2 integer NOT NULL,
    min_income_threshold_3 integer NOT NULL,
    min_income_threshold_4 integer NOT NULL,
    min_income_threshold_5 integer NOT NULL,
    min_income_threshold_6 integer NOT NULL,
    income_multiplier_2 numeric(5,4) NOT NULL,
    income_multiplier_3 numeric(5,4) NOT NULL,
    income_multiplier_4 numeric(5,4) NOT NULL,
    income_multiplier_5 numeric(5,4) NOT NULL,
    income_multiplier_6 numeric(5,4) NOT NULL,
    max_income_threshold_2 integer NOT NULL,
    max_income_threshold_3 integer NOT NULL,
    max_income_threshold_4 integer NOT NULL,
    max_income_threshold_5 integer NOT NULL,
    max_income_threshold_6 integer NOT NULL,
    income_threshold_increase_6_plus integer NOT NULL,
    sibling_discount_2 numeric(5,4) NOT NULL,
    sibling_discount_2_plus numeric(5,4) NOT NULL,
    max_fee integer NOT NULL,
    min_fee integer NOT NULL
);

INSERT INTO fee_thresholds (
    id,
    valid_during,
    min_income_threshold_2,
    min_income_threshold_3,
    min_income_threshold_4,
    min_income_threshold_5,
    min_income_threshold_6,
    income_multiplier_2,
    income_multiplier_3,
    income_multiplier_4,
    income_multiplier_5,
    income_multiplier_6,
    max_income_threshold_2,
    max_income_threshold_3,
    max_income_threshold_4,
    max_income_threshold_5,
    max_income_threshold_6,
    income_threshold_increase_6_plus,
    sibling_discount_2,
    sibling_discount_2_plus,
    min_fee,
    max_fee
)
SELECT
    id,
    daterange(valid_from, valid_to, '[]'),
    min_threshold_2,
    min_threshold_3,
    min_threshold_4,
    min_threshold_5,
    min_threshold_6,
    multiplier,
    multiplier,
    multiplier,
    multiplier,
    multiplier,
    min_threshold_2 + max_threshold_difference,
    min_threshold_3 + max_threshold_difference,
    min_threshold_4 + max_threshold_difference,
    min_threshold_5 + max_threshold_difference,
    min_threshold_6 + max_threshold_difference,
    threshold_increase_6_plus,
    0.5,
    0.8,
    2700,
    round(max_threshold_difference * multiplier / 100) * 100
FROM pricing;
